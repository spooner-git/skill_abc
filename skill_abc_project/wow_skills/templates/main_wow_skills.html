{% extends "wow_skills_base.html" %}

{% load static_url %}
{% block local_css %}
{% endblock %}

{% block top_right %}
<button style="float: right;border:0;" onclick="location.href='/wow_skills/admin/'">참여</button>
{% endblock %} 

{% block content %}
<div id="search_tool_wrap" style="display:flex;height:40px;">
    <form action="{% url 'wow_skills:get_wow_skill_info' %}" name="get_wow_skill_info" id="form_get_wow_skill_info" method="get" style="display: flex;width:100%;">
        {% csrf_token %}
        <input type="hidden" name="search_type" value="name">
        <div style="flex:1 1 0;height:100%">
            <input type="text" name="search_val" style="width:100%;height:100%;box-sizing: border-box;font-size:18px;font-weight:500" placeholder="검색어 입력">
        </div>
        <div style="flex-basis:110px;height:100%;text-align:right;">
            <button style="height:100%;" onclick="search(event);">검색</button>
            <button style="height:100%;" onclick="init(event)">초기화</button>
        </div>
    </form>
</div>

<div id="result_display_wrap" style="margin-top: 50px;">
    <div class="result_row">
        <!--<img src="https://wow.zamimg.com/images/wow/icons/large/spell_shadow_ritualofsacrifice.jpg" alt="" style="vertical-align: middle;">
        <span style="vertical-align: middle;">사악한 일격</span>-->
        <div>
            <img src="" id="skill_small_img">
            <img src="" id="skill_medium_img">
            <img src="" id="skill_large_img">
        </div>
        <div id="description_wrapper" style="display: inline-block;">
        </div>
        <div id="description_wrapper_img">
        </div>
    </div>
</div>
{% endblock %}

{% block local_js_footer %}
    <script>

    function init(e){
        e.preventDefault();
        e.stopPropagation();
        location.reload();
    }

    function search(e){
        e.stopPropagation();
        e.preventDefault();
        $.ajax({
            url: '/wow_skills/get_wow_skill_info/',
{#            url: '/wow_skills/get_wow_skill_info_from_blizzard/',#}
            data: $('#form_get_wow_skill_info').serialize(),
            dataType: 'json',
            type: 'GET',

            beforeSend: function () {
                $('#skill_id').text('');
                $('#skill_name').text('');
                $('#skill_icon').text('');
                $('#skill_description').text('');
                $('#skill_cast_time').text('');
                $('#skill_power_cost').text('');
                $('#skill_range').text('');
                $('#skill_cool_down').text('');
                $('#skill_small_img').attr('src', '');
                $('#skill_medium_img').attr('src', '');
                $('#skill_large_img').attr('src', '');
            },

            success: function (data) {
                if(Object.keys(data).length == 0){
                    $('#skill_icon_img').attr('src', '');
                    alert('blizzard api에 없는 skill 입니다.');
                    return;
                }
                let html = '';
                let wow_skill_data = data.wow_skill;
                for(let i=0; i<wow_skill_data.length; i++){
                    $('#skill_small_img').attr('src', wow_skill_data[i].wow_small_img_url);
                    $('#skill_medium_img').attr('src', wow_skill_data[i].wow_medium_img_url);
                    $('#skill_large_img').attr('src', wow_skill_data[i].wow_large_img_url);
                    html += dom_description(wow_skill_data[i]);
                }
                $('#description_wrapper').html(html);
            },

            complete: function () {
            },

            error: function () {
            }
        });
    }

    function dom_description(data){

        let skill_id = data.wow_skill_id;
        let skill_name = data.wow_skill_name;
        let skill_cost = data.wow_power_cost;
        let skill_cast_time = data.wow_cast_time;
        let skill_class_name = data.wow_class_name;
        let skill_specialize = data.wow_specialize_name;
        let skill_cool_down = data.wow_cool_down;
        let skill_range = data.wow_range;
        let skill_description = data.wow_description;

        let html = 
                    `
                    <div style="width:100%;max-width:300px;padding:10px;border-radius:5px;border:1px solid #f5f2f3;background-color:#161721d9;color:#ffffff;font-weight:500;font-size:14px;box-sizing:border-box">
                        <div>${skill_name}</div>
                        <div style="display:flex;margin-top:3px;">
                            ${skill_cost == undefined ? "" : '<div style="flex:1 1 0">'+skill_cost+'</div>'}
                            ${skill_range == undefined ? "" : '<div style="flex:1 1 0;text-align:right;">'+skill_range+'</div>'}
                        </div>
                        <div style="display:flex;margin-top:3px;">
                            ${skill_cast_time == undefined ? "" : '<div style="flex:1 1 0">'+skill_cast_time+'</div>'}
                            ${skill_cool_down == undefined ? "" : '<div style="flex:1 1 0;text-align:right;">'+skill_cool_down+'</div>'}
                        </div>
                        <div style="margin-top:10px;color:#edb31c;">
                            ${skill_description == undefined ? "" : skill_description}
                        </div>
                    </div>`;
        return html;
    }

    </script>
{% endblock %}